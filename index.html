
<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å£½å¸éƒè¨ˆæ•¸æ©Ÿ | Sushiro Calc</title>
    
    <!-- PWA é…ç½® -->
    <meta name="theme-color" content="#e11d48">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Babel: è®“ç€è¦½å™¨ç›´æ¥é‹è¡Œ React ä»£ç¢¼ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans HK', sans-serif;
            background-color: #f8fafc;
            margin: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .sushiro-red { background-color: #e11d48; }
        .text-sushiro { color: #e11d48; }
        
        /* è¼‰å…¥å‹•ç•« */
        #loading-screen {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            z-index: 100;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e11d48;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-screen">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: #64748b; font-weight: bold;">æ­£åœ¨å•Ÿå‹•å£½å¸éƒè¨ˆæ•¸æ©Ÿ...</p>
    </div>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- æ•¸æ“šé…ç½® ---
        const PLATES = [
          { id: 'red', name: 'ç´…ç¢Ÿ', price: 12, bgColor: 'bg-red-500', textColor: 'text-white', borderColor: 'border-red-700' },
          { id: 'silver', name: 'éŠ€ç¢Ÿ', price: 17, bgColor: 'bg-slate-300', textColor: 'text-slate-800', borderColor: 'border-slate-400' },
          { id: 'gold', name: 'é‡‘ç¢Ÿ', price: 22, bgColor: 'bg-amber-400', textColor: 'text-amber-900', borderColor: 'border-amber-600' },
          { id: 'black', name: 'é»‘ç¢Ÿ', price: 27, bgColor: 'bg-zinc-800', textColor: 'text-white', borderColor: 'border-zinc-900' }
        ];

        const OTHER_ITEMS = [
          { id: 's12', name: 'å°é£Ÿ/ç”œå“ $12', price: 12 },
          { id: 's17', name: 'å°é£Ÿ/ç”œå“ $17', price: 17 },
          { id: 's22', name: 'å°é£Ÿ/ç”œå“ $22', price: 22 },
          { id: 's27', name: 'å°é£Ÿ/ç”œå“ $27', price: 27 },
          { id: 's32', name: 'ç‰¹é¸ $32', price: 32 },
          { id: 's37', name: 'ç‰¹é¸ $37', price: 37 }
        ];

        // --- çµ„ä»¶ ---
        const PlateCounter = ({ plate, count, onIncrement, onDecrement }) => (
          <div className={`flex flex-col items-center p-4 rounded-2xl shadow-sm border-2 ${plate.borderColor} ${plate.bgColor} ${plate.textColor} transition-all active:scale-95`}>
            <span className="text-sm font-bold mb-1 opacity-90 uppercase tracking-tight">{plate.name}</span>
            <span className="text-2xl font-black mb-3">${plate.price}</span>
            <div className="flex items-center space-x-4 bg-white/20 rounded-full px-2 py-1">
              <button onClick={onDecrement} className="w-10 h-10 flex items-center justify-center rounded-full bg-white/30 text-2xl font-bold" disabled={count === 0}>-</button>
              <span className="text-3xl font-mono min-w-[2rem] text-center">{count}</span>
              <button onClick={onIncrement} className="w-10 h-10 flex items-center justify-center rounded-full bg-white/30 text-2xl font-bold">+</button>
            </div>
          </div>
        );

        const App = () => {
          const [order, setOrder] = useState(() => {
            const saved = localStorage.getItem('sushiro_order_v3');
            return saved ? JSON.parse(saved) : {};
          });
          
          const [hasServiceCharge, setHasServiceCharge] = useState(true);
          const [showResetConfirm, setShowResetConfirm] = useState(false);
          const [showReceipt, setShowReceipt] = useState(false);
          const [copyFeedback, setCopyFeedback] = useState(false);

          useEffect(() => {
            localStorage.setItem('sushiro_order_v3', JSON.stringify(order));
          }, [order]);

          const updateCount = (id, delta) => {
            setOrder(prev => ({
              ...prev,
              [id]: Math.max(0, (prev[id] || 0) + delta)
            }));
          };

          const totals = useMemo(() => {
            let subtotal = 0;
            let plateCount = 0;
            const items = [];
            
            [...PLATES, ...OTHER_ITEMS].forEach(p => {
              const count = order[p.id] || 0;
              if (count > 0) {
                const itemTotal = count * p.price;
                subtotal += itemTotal;
                plateCount += count;
                items.push({ name: p.name, count, total: itemTotal });
              }
            });

            const serviceCharge = hasServiceCharge ? Math.round(subtotal * 0.1) : 0;
            return { subtotal, serviceCharge, total: subtotal + serviceCharge, plateCount, items };
          }, [order, hasServiceCharge]);

          const handleCopy = () => {
            let text = `ğŸ£ å£½å¸éƒçµå¸³å‚™å¿˜\n------------------\n`;
            totals.items.forEach(i => text += `${i.name} x${i.count}: $${i.total}\n`);
            text += `------------------\nç¸½é¡: $${totals.total}\nç¸½ç¢Ÿæ•¸: ${totals.plateCount}\n`;
            navigator.clipboard.writeText(text);
            setCopyFeedback(true);
            setTimeout(() => setCopyFeedback(false), 2000);
          };

          return (
            <div className="max-w-md mx-auto min-h-screen flex flex-col bg-slate-50 pb-32 relative">
              <header className="sushiro-red text-white p-6 sticky top-0 z-40 shadow-md">
                <div className="flex justify-between items-center">
                  <h1 className="text-2xl font-black italic">SUSHIRO <span className="font-normal not-italic ml-1 text-lg">è¨ˆæ•¸æ©Ÿ</span></h1>
                  <button onClick={() => setShowResetConfirm(true)} className="text-xs bg-black/20 px-3 py-1.5 rounded-full border border-white/30">é‡è¨­</button>
                </div>
                <div className="mt-4 flex justify-between items-end">
                  <div>
                    <p className="text-red-100 text-[10px] uppercase font-bold tracking-widest">Estimated Total</p>
                    <p className="text-5xl font-black font-mono">${totals.total}</p>
                  </div>
                  <p className="text-red-100 text-xs font-bold">{totals.plateCount} ç¢Ÿ</p>
                </div>
              </header>

              <main className="flex-1 p-4 space-y-6">
                <section className="grid grid-cols-2 gap-4">
                  {PLATES.map(p => (
                    <PlateCounter key={p.id} plate={p} count={order[p.id] || 0}
                      onIncrement={() => updateCount(p.id, 1)} onDecrement={() => updateCount(p.id, -1)} />
                  ))}
                </section>

                <section className="bg-white rounded-3xl p-5 shadow-sm border border-slate-200">
                  <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center">
                    <span className="w-1.5 h-6 sushiro-red rounded-full mr-2"></span>å…¶ä»–é …ç›®
                  </h2>
                  <div className="space-y-2">
                    {OTHER_ITEMS.map(item => (
                      <div key={item.id} className="flex items-center justify-between p-3 bg-slate-50 rounded-2xl">
                        <span className="font-bold text-slate-700">{item.name}</span>
                        <div className="flex items-center space-x-3">
                          <button onClick={() => updateCount(item.id, -1)} className="w-9 h-9 border border-slate-300 rounded-full disabled:opacity-20" disabled={!order[item.id]}>-</button>
                          <span className="font-mono font-bold w-6 text-center">{order[item.id] || 0}</span>
                          <button onClick={() => updateCount(item.id, 1)} className="w-9 h-9 border border-slate-300 rounded-full">+</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </section>
              </main>

              {showResetConfirm && (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                  <div className="bg-white w-full max-w-xs rounded-3xl p-8">
                    <h3 className="text-xl font-bold text-center mb-6">ç¢ºå®šæ¸…ç©ºè¨˜éŒ„ï¼Ÿ</h3>
                    <div className="flex space-x-3">
                      <button onClick={() => setShowResetConfirm(false)} className="flex-1 py-4 rounded-2xl bg-slate-100 font-bold">å–æ¶ˆ</button>
                      <button onClick={() => {setOrder({}); setShowResetConfirm(false);}} className="flex-1 py-4 rounded-2xl sushiro-red text-white font-bold">ç¢ºå®š</button>
                    </div>
                  </div>
                </div>
              )}

              {showReceipt && (
                <div className="fixed inset-0 z-[60] flex items-end justify-center bg-black/60 backdrop-blur-sm">
                  <div className="bg-white w-full max-w-md rounded-t-[2.5rem] p-8 shadow-2xl">
                    <div className="flex justify-between items-center mb-6">
                      <h3 className="text-2xl font-black">çµå¸³å‚™å¿˜</h3>
                      <button onClick={() => setShowReceipt(false)} className="p-2 bg-slate-100 rounded-full">âœ•</button>
                    </div>
                    <div className="bg-slate-50 rounded-2xl p-6 mb-8 font-mono text-sm space-y-2 border-dashed border-2 border-slate-200">
                      {totals.items.map((i, idx) => (
                        <div key={idx} className="flex justify-between"><span>{i.name} x{i.count}</span><span>${i.total}</span></div>
                      ))}
                      <div className="border-t border-slate-200 pt-3 mt-3">
                        <div className="flex justify-between text-lg font-black text-sushiro"><span>ç¸½è¨ˆ</span><span>${totals.total}</span></div>
                      </div>
                    </div>
                    <button onClick={handleCopy} className={`w-full py-4 rounded-2xl font-bold ${copyFeedback ? 'bg-green-500 text-white' : 'bg-slate-900 text-white'}`}>
                      {copyFeedback ? 'å·²è¤‡è£½ï¼' : 'è¤‡è£½çµæœ'}
                    </button>
                  </div>
                </div>
              )}

              <footer className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t p-4 shadow-lg z-40">
                <div className="flex justify-between items-center px-2">
                  <div className="flex flex-col">
                    <div className="flex items-center mb-1">
                      <input type="checkbox" id="sc" checked={hasServiceCharge} onChange={e => setHasServiceCharge(e.target.checked)} className="mr-2" />
                      <label htmlFor="sc" className="text-[10px] font-bold text-slate-400 uppercase">åŠ ä¸€æœå‹™è²»</label>
                    </div>
                    <span className="text-3xl font-black text-sushiro">${totals.total}</span>
                  </div>
                  <button onClick={() => setShowReceipt(true)} className="bg-slate-900 text-white px-8 py-3.5 rounded-2xl font-bold">çµå¸³å‚™å¿˜</button>
                </div>
              </footer>
            </div>
          );
        };

        // åˆå§‹åŒ– React
        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);

        // éš±è—è¼‰å…¥ç•«é¢
        setTimeout(() => {
          const loader = document.getElementById('loading-screen');
          if(loader) {
            loader.style.opacity = '0';
            setTimeout(() => loader.remove(), 500);
          }
        }, 500);
    </script>
</body>
</html>
